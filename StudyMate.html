<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>StudyMate â€” Your Academic Companion</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;700;800&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #070710;
    --surface: #0f0f1a;
    --card: #14141f;
    --card2: #1a1a2e;
    --border: #ffffff12;
    --border2: #ffffff1e;
    --accent: #7c6af7;
    --accent2: #a78bfa;
    --teal: #2dd4bf;
    --coral: #f87171;
    --gold: #fbbf24;
    --pink: #ec4899;
    --text: #f0f0fa;
    --muted: #6b6b8f;
    --glow: #7c6af733;
  }
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
  html { scroll-behavior: smooth; }
  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'DM Sans', sans-serif;
    overflow-x: hidden;
    min-height: 100vh;
  }
  ::-webkit-scrollbar { width: 5px; }
  ::-webkit-scrollbar-track { background: var(--surface); }
  ::-webkit-scrollbar-thumb { background: var(--accent); border-radius: 3px; }

  /* â”€â”€ Canvas BG â”€â”€ */
  #bg-canvas {
    position: fixed; inset: 0;
    width: 100%; height: 100%;
    pointer-events: none; z-index: 0;
  }

  /* â”€â”€ App Shell â”€â”€ */
  .app { position: relative; z-index: 1; display: flex; min-height: 100vh; }

  /* â”€â”€ Sidebar â”€â”€ */
  .sidebar {
    width: 220px; min-height: 100vh;
    background: var(--surface);
    border-right: 1px solid var(--border);
    padding: 24px 12px;
    display: flex; flex-direction: column;
    position: fixed; left: 0; top: 0; bottom: 0;
    z-index: 200;
    backdrop-filter: blur(24px);
    transition: transform .3s cubic-bezier(.4,0,.2,1);
  }
  .sidebar-logo {
    display: flex; align-items: center; gap: 10px;
    font-family: 'Syne', sans-serif; font-size: 20px; font-weight: 800;
    color: var(--accent2); letter-spacing: -.5px;
    margin-bottom: 32px; padding: 0 8px;
  }
  .logo-gem {
    width: 30px; height: 30px; border-radius: 8px;
    background: linear-gradient(135deg, var(--accent), var(--teal));
    box-shadow: 0 0 20px var(--glow);
    animation: gemPulse 3s ease-in-out infinite;
    flex-shrink: 0;
  }
  @keyframes gemPulse {
    0%,100%{box-shadow:0 0 16px var(--glow);}
    50%{box-shadow:0 0 36px #7c6af766;}
  }
  .nav-link {
    display: flex; align-items: center; gap: 11px;
    padding: 11px 14px; border-radius: 12px; cursor: pointer;
    font-size: 14px; font-weight: 500; color: var(--muted);
    transition: all .18s; margin-bottom: 2px; border: 1px solid transparent;
    user-select: none;
  }
  .nav-link:hover { background: var(--card2); color: var(--text); }
  .nav-link.active { background: var(--glow); color: var(--accent2); border-color: var(--accent)33; }
  .nav-icon { font-size: 17px; width: 22px; text-align: center; }
  .nav-badge {
    margin-left: auto; background: var(--coral);
    color: white; font-size: 10px; font-weight: 700;
    border-radius: 10px; padding: 2px 6px; min-width: 18px; text-align: center;
  }
  .sidebar-user {
    margin-top: auto;
    padding: 14px; border-radius: 14px;
    background: var(--glow); border: 1px solid var(--accent)33;
  }
  .sidebar-user-name { font-size: 13px; font-weight: 600; color: var(--text); }
  .sidebar-user-email { font-size: 11px; color: var(--muted); margin-top: 2px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }

  /* â”€â”€ Main â”€â”€ */
  .main { margin-left: 220px; flex: 1; padding: 36px 32px; }

  /* â”€â”€ Pages â”€â”€ */
  .page { display: none; animation: pageIn .35s ease; }
  .page.active { display: block; }
  @keyframes pageIn {
    from { opacity: 0; transform: translateY(16px); }
    to { opacity: 1; transform: translateY(0); }
  }

  /* â”€â”€ Auth â”€â”€ */
  .auth-screen {
    min-height: 100vh; display: flex;
    align-items: center; justify-content: center; padding: 24px;
  }
  .auth-box {
    width: 100%; max-width: 400px;
    background: var(--card); border: 1px solid var(--border2);
    border-radius: 24px; padding: 40px;
    box-shadow: 0 32px 80px #00000060;
    animation: pageIn .5s ease;
  }
  .auth-logo { display: flex; align-items: center; gap: 10px; margin-bottom: 28px; }
  .auth-title { font-family: 'Syne', sans-serif; font-size: 26px; font-weight: 800; margin-bottom: 6px; background: linear-gradient(135deg, var(--text), var(--accent2)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
  .auth-sub { font-size: 14px; color: var(--muted); margin-bottom: 28px; }

  /* â”€â”€ Forms â”€â”€ */
  .form-group { margin-bottom: 14px; }
  .form-label { display: block; font-size: 12px; font-weight: 600; color: var(--muted); margin-bottom: 6px; text-transform: uppercase; letter-spacing: .5px; }
  .input {
    width: 100%; padding: 12px 16px;
    background: var(--surface); color: var(--text);
    border: 1px solid var(--border2); border-radius: 12px;
    font-size: 14px; font-family: 'DM Sans', sans-serif;
    outline: none; transition: border-color .2s, box-shadow .2s;
  }
  .input:focus { border-color: var(--accent); box-shadow: 0 0 0 3px var(--glow); }
  .input::placeholder { color: var(--muted); }
  select.input { appearance: none; cursor: pointer; }

  /* â”€â”€ Buttons â”€â”€ */
  .btn {
    display: inline-flex; align-items: center; justify-content: center; gap: 7px;
    padding: 11px 20px; border-radius: 11px; border: none;
    font-size: 14px; font-weight: 600; font-family: 'DM Sans', sans-serif;
    cursor: pointer; transition: all .18s; position: relative; overflow: hidden;
    white-space: nowrap;
  }
  .btn::after { content: ''; position: absolute; inset: 0; background: white; opacity: 0; transition: opacity .15s; }
  .btn:hover::after { opacity: .07; }
  .btn:active { transform: scale(.97); }
  .btn-primary { background: var(--accent); color: white; box-shadow: 0 4px 20px var(--glow); }
  .btn-primary:hover { box-shadow: 0 6px 28px #7c6af755; }
  .btn-teal { background: var(--teal); color: #000; }
  .btn-coral { background: var(--coral); color: white; }
  .btn-ghost { background: transparent; border: 1px solid var(--border2); color: var(--muted); }
  .btn-ghost:hover { border-color: var(--accent); color: var(--accent2); }
  .btn-sm { padding: 7px 13px; font-size: 12px; border-radius: 8px; }
  .btn-full { width: 100%; padding: 14px; font-size: 15px; }
  .btn-icon { padding: 8px; width: 34px; height: 34px; border-radius: 8px; }

  /* â”€â”€ Page Header â”€â”€ */
  .ph { margin-bottom: 28px; }
  .ph-title { font-family: 'Syne', sans-serif; font-size: 30px; font-weight: 800; background: linear-gradient(120deg, var(--text) 40%, var(--accent2)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
  .ph-sub { font-size: 13px; color: var(--muted); margin-top: 4px; }

  /* â”€â”€ Cards â”€â”€ */
  .card {
    background: var(--card); border: 1px solid var(--border);
    border-radius: 18px; padding: 22px;
    transition: border-color .2s, box-shadow .2s, transform .2s;
    position: relative; overflow: hidden;
  }
  .card::before {
    content: ''; position: absolute; inset: 0;
    background: linear-gradient(135deg, var(--accent)07 0%, transparent 55%);
    pointer-events: none;
  }
  .card:hover { border-color: var(--accent)33; box-shadow: 0 8px 30px #00000040; }
  .card-title { font-family: 'Syne', sans-serif; font-size: 15px; font-weight: 700; margin-bottom: 16px; display: flex; align-items: center; gap: 8px; }

  /* â”€â”€ Grid â”€â”€ */
  .g2 { display: grid; grid-template-columns: 1fr 1fr; gap: 18px; }
  .g3 { display: grid; grid-template-columns: repeat(3,1fr); gap: 16px; }
  .g4 { display: grid; grid-template-columns: repeat(4,1fr); gap: 16px; }

  /* â”€â”€ Stat Cards â”€â”€ */
  .stat-card {
    background: var(--card); border: 1px solid var(--border);
    border-radius: 16px; padding: 20px; text-align: center;
    position: relative; overflow: hidden; transition: transform .2s, box-shadow .2s;
  }
  .stat-card:hover { transform: translateY(-4px); box-shadow: 0 12px 40px #00000050; }
  .stat-card::after { content: ''; position: absolute; bottom: 0; left: 0; right: 0; height: 3px; border-radius: 0 0 16px 16px; }
  .s-accent::after { background: var(--accent); }
  .s-teal::after { background: var(--teal); }
  .s-coral::after { background: var(--coral); }
  .s-gold::after { background: var(--gold); }
  .stat-num { font-family: 'Syne', sans-serif; font-size: 36px; font-weight: 800; line-height: 1; }
  .stat-lbl { font-size: 11px; color: var(--muted); margin-top: 5px; text-transform: uppercase; letter-spacing: .8px; }

  /* â”€â”€ Tasks â”€â”€ */
  .task-item {
    display: flex; align-items: center; gap: 11px;
    background: var(--surface); border: 1px solid var(--border);
    border-radius: 12px; padding: 13px 15px;
    transition: border-color .15s; margin-bottom: 8px;
    animation: slideInLeft .25s ease;
  }
  @keyframes slideInLeft { from{opacity:0;transform:translateX(-16px)} to{opacity:1;transform:translateX(0)} }
  .task-item:hover { border-color: var(--accent)33; }
  .task-item.done { opacity: .45; }
  .task-item.done .task-name { text-decoration: line-through; }
  .task-check {
    width: 21px; height: 21px; border-radius: 50%;
    border: 2px solid var(--border2); cursor: pointer;
    transition: all .2s; flex-shrink: 0;
    display: flex; align-items: center; justify-content: center;
    font-size: 11px; color: white;
  }
  .task-check.on { background: var(--teal); border-color: var(--teal); }
  .task-prio { width: 7px; height: 7px; border-radius: 50%; flex-shrink: 0; }
  .task-name { flex: 1; font-size: 14px; }
  .task-meta { font-size: 12px; color: var(--muted); display: flex; align-items: center; gap: 6px; flex-shrink: 0; }
  .task-meta.late { color: var(--coral); }

  /* â”€â”€ Timetable â”€â”€ */
  .tt-wrap { overflow-x: auto; }
  .tt {
    display: grid; grid-template-columns: 72px repeat(7,1fr);
    gap: 2px; background: var(--border); border-radius: 12px; overflow: hidden;
    min-width: 600px;
  }
  .tt-h { background: var(--surface); padding: 10px 6px; font-size: 11px; font-weight: 700; color: var(--accent2); text-align: center; text-transform: uppercase; letter-spacing: .5px; }
  .tt-t { background: var(--surface); padding: 10px 6px; font-size: 11px; color: var(--muted); text-align: center; }
  .tt-c { background: var(--surface); padding: 8px 4px; font-size: 10px; text-align: center; min-height: 38px; display: flex; align-items: center; justify-content: center; font-weight: 500; }

  /* â”€â”€ Notes â”€â”€ */
  .notes-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(170px,1fr)); gap: 14px; }
  .note-card {
    background: var(--surface); border: 1px solid var(--border);
    border-radius: 16px; padding: 18px; text-align: center;
    cursor: pointer; transition: all .2s; animation: fadeUp .3s ease;
  }
  @keyframes fadeUp { from{opacity:0;transform:translateY(14px)} to{opacity:1;transform:translateY(0)} }
  .note-card:hover { border-color: var(--accent)44; transform: translateY(-3px); box-shadow: 0 8px 24px #00000050; }
  .note-icon-big { font-size: 34px; margin-bottom: 10px; }
  .note-fname { font-size: 12px; font-weight: 500; word-break: break-all; margin-bottom: 3px; }
  .note-fsize { font-size: 11px; color: var(--muted); }

  /* â”€â”€ Upload â”€â”€ */
  .dropzone {
    border: 2px dashed var(--border2); border-radius: 16px;
    padding: 40px 24px; text-align: center; cursor: pointer;
    transition: all .2s; margin-bottom: 20px;
  }
  .dropzone:hover, .dropzone.dragging { border-color: var(--accent); background: var(--glow); }
  .dz-icon { font-size: 38px; margin-bottom: 10px; }
  .dz-text { font-weight: 600; margin-bottom: 4px; }
  .dz-hint { font-size: 13px; color: var(--muted); }

  /* â”€â”€ AI Chat â”€â”€ */
  .chat-area { display: flex; flex-direction: column; gap: 12px; max-height: 360px; overflow-y: auto; margin-bottom: 16px; padding-right: 4px; }
  .msg { display: flex; gap: 10px; animation: slideInLeft .25s ease; }
  .msg.user { flex-direction: row-reverse; }
  .msg-avatar { width: 30px; height: 30px; border-radius: 50%; flex-shrink: 0; display: flex; align-items: center; justify-content: center; font-size: 14px; }
  .msg.bot .msg-avatar { background: linear-gradient(135deg, var(--accent), var(--teal)); }
  .msg.user .msg-avatar { background: var(--card2); border: 1px solid var(--border2); }
  .msg-bubble { max-width: 78%; padding: 11px 15px; font-size: 14px; line-height: 1.55; border-radius: 16px; }
  .msg.user .msg-bubble { background: var(--accent); color: white; border-radius: 16px 16px 4px 16px; }
  .msg.bot .msg-bubble { background: var(--surface); border: 1px solid var(--border2); border-radius: 16px 16px 16px 4px; }
  .dots span { display: inline-block; width: 6px; height: 6px; border-radius: 50%; background: var(--muted); margin: 0 2px; animation: dot .7s ease infinite; }
  .dots span:nth-child(2){animation-delay:.15s} .dots span:nth-child(3){animation-delay:.3s}
  @keyframes dot{0%,80%,100%{transform:translateY(0)}40%{transform:translateY(-6px)}}
  .quick-chips { display: flex; flex-wrap: wrap; gap: 7px; margin-top: 10px; }
  .chip { padding: 5px 12px; border-radius: 20px; border: 1px solid var(--border2); font-size: 12px; color: var(--muted); cursor: pointer; transition: all .15s; }
  .chip:hover { border-color: var(--accent); color: var(--accent2); }

  /* â”€â”€ Progress Ring â”€â”€ */
  .ring-wrap { position: relative; display: inline-flex; align-items: center; justify-content: center; }
  .ring-label { position: absolute; text-align: center; }
  .ring-pct { font-family: 'Syne', sans-serif; font-size: 22px; font-weight: 800; }
  .ring-lbl { font-size: 10px; color: var(--muted); }

  /* â”€â”€ Chart â”€â”€ */
  .bar-chart { display: flex; align-items: flex-end; gap: 10px; height: 150px; padding: 0 4px; }
  .bar-col { flex: 1; display: flex; flex-direction: column; align-items: center; gap: 5px; height: 100%; justify-content: flex-end; }
  .bar-fill { width: 100%; border-radius: 7px 7px 0 0; min-height: 4px; position: relative; overflow: hidden; transition: height 1s cubic-bezier(.4,0,.2,1); }
  .bar-fill::after { content:''; position:absolute; top:0; left:0; right:0; height:45%; background: rgba(255,255,255,.08); border-radius: 7px 7px 0 0; }
  .bar-day { font-size: 10px; color: var(--muted); }
  .bar-count { font-size: 12px; font-weight: 600; color: var(--accent2); }

  /* â”€â”€ Profile Avatar â”€â”€ */
  .avatar-big {
    width: 78px; height: 78px; border-radius: 50%;
    background: linear-gradient(135deg, var(--accent), var(--teal));
    display: flex; align-items: center; justify-content: center;
    font-family: 'Syne', sans-serif; font-size: 30px; font-weight: 800;
    box-shadow: 0 0 32px var(--glow); margin-bottom: 12px; flex-shrink: 0;
  }

  /* â”€â”€ Toast â”€â”€ */
  #toast-container { position: fixed; bottom: 22px; right: 22px; z-index: 9999; display: flex; flex-direction: column; gap: 8px; pointer-events: none; }
  .toast {
    background: var(--card2); border: 1px solid var(--border2);
    border-radius: 12px; padding: 12px 18px;
    font-size: 13px; display: flex; align-items: center; gap: 9px;
    box-shadow: 0 8px 24px #00000060; min-width: 230px;
    animation: toastIn .3s ease;
  }
  @keyframes toastIn { from{opacity:0;transform:translateX(30px)} to{opacity:1;transform:translateX(0)} }

  /* â”€â”€ Misc â”€â”€ */
  .divider { height: 1px; background: var(--border); margin: 18px 0; }
  .pill { display: inline-flex; align-items: center; gap: 4px; padding: 4px 10px; border-radius: 20px; font-size: 11px; font-weight: 600; }
  .p-accent { background: var(--glow); color: var(--accent2); }
  .p-teal { background: #2dd4bf22; color: var(--teal); }
  .p-coral { background: #f8717122; color: var(--coral); }
  .p-gold { background: #fbbf2422; color: var(--gold); }
  .row { display: flex; align-items: center; gap: 10px; }
  .gap-y > * + * { margin-top: 8px; }
  .muted { color: var(--muted); }
  .mb8 { margin-bottom: 8px; }
  .mb16 { margin-bottom: 16px; }
  .mb24 { margin-bottom: 24px; }
  .mt16 { margin-top: 16px; }
  .text-sm { font-size: 13px; }
  .text-xs { font-size: 11px; }
  .center { text-align: center; }
  .flex-center { display: flex; align-items: center; justify-content: center; }
  .link { color: var(--accent2); cursor: pointer; font-weight: 500; }
  .link:hover { text-decoration: underline; }
  .progress-bar-wrap { height: 6px; background: var(--border2); border-radius: 3px; overflow: hidden; margin-top: 4px; }
  .progress-bar-fill { height: 100%; border-radius: 3px; transition: width 1s; }

  /* â”€â”€ Hamburger â”€â”€ */
  #ham-btn { display: none; position: fixed; top: 16px; left: 16px; z-index: 300; background: var(--card); border: 1px solid var(--border2); border-radius: 10px; width: 40px; height: 40px; align-items: center; justify-content: center; cursor: pointer; font-size: 18px; }
  @media(max-width:900px){
    .sidebar { transform: translateX(-100%); }
    .sidebar.open { transform: translateX(0); }
    .main { margin-left: 0; padding: 24px 16px; }
    .g2,.g3,.g4 { grid-template-columns: 1fr; }
    #ham-btn { display: flex; }
  }

  /* â”€â”€ Subject tags in timetable â”€â”€ */
  .sub-tag {
    display: inline-flex; align-items: center; gap: 6px;
    padding: 5px 10px; border-radius: 20px; font-size: 12px;
    font-weight: 600; cursor: pointer; transition: all .15s;
  }
  .sub-tag .rem { font-size: 14px; cursor: pointer; opacity: .7; line-height: 1; }
  .sub-tag .rem:hover { opacity: 1; }

  /* â”€ Separator line in profile stats â”€ */
  .profile-stat { text-align: center; padding: 14px; background: var(--surface); border-radius: 12px; }
  .profile-stat .val { font-family: 'Syne', sans-serif; font-size: 26px; font-weight: 800; line-height: 1; }
  .profile-stat .lbl { font-size: 11px; color: var(--muted); margin-top: 3px; }
</style>
</head>
<body>

<!-- Canvas BG -->
<canvas id="bg-canvas"></canvas>

<!-- Toast Container -->
<div id="toast-container"></div>

<!-- Hamburger -->
<div id="ham-btn" onclick="toggleSidebar()">â˜°</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• AUTH â•â• -->
<div id="auth-screen" class="auth-screen">
  <div class="auth-box">
    <div class="auth-logo">
      <div class="logo-gem"></div>
      <span style="font-family:'Syne',sans-serif;font-size:20px;font-weight:800;color:var(--accent2)">StudyMate</span>
    </div>
    <div id="auth-title" class="auth-title">Welcome back</div>
    <div id="auth-sub" class="auth-sub">Log in to continue your journey</div>

    <div id="auth-name-group" class="form-group" style="display:none">
      <label class="form-label">Full Name</label>
      <input id="auth-name" class="input" placeholder="Alex Johnson" />
    </div>
    <div class="form-group">
      <label class="form-label">Email</label>
      <input id="auth-email" class="input" type="email" placeholder="alex@university.edu" />
    </div>
    <div class="form-group" style="margin-bottom:22px">
      <label class="form-label">Password</label>
      <input id="auth-pass" class="input" type="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" onkeydown="if(event.key==='Enter')authSubmit()" />
    </div>
    <button class="btn btn-primary btn-full" onclick="authSubmit()">
      <span id="auth-btn-text">ğŸš€ Sign In</span>
    </button>
    <div class="center mt16 text-sm muted">
      <span id="auth-switch-text">Don't have an account?</span>
      <span class="link" onclick="toggleAuthMode()" id="auth-switch-link" style="margin-left:4px">Sign up</span>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• MAIN APP â•â• -->
<div id="main-app" class="app" style="display:none">
  <!-- Sidebar -->
  <nav class="sidebar" id="sidebar">
    <div class="sidebar-logo">
      <div class="logo-gem"></div>
      StudyMate
    </div>
    <div class="nav-link active" data-page="dashboard" onclick="goTo('dashboard',this)"><span class="nav-icon">ğŸ </span> Dashboard</div>
    <div class="nav-link" data-page="tasks" onclick="goTo('tasks',this)"><span class="nav-icon">ğŸ“</span> Tasks <span id="pending-badge" class="nav-badge" style="display:none"></span></div>
    <div class="nav-link" data-page="timetable" onclick="goTo('timetable',this)"><span class="nav-icon">ğŸ“…</span> Timetable</div>
    <div class="nav-link" data-page="notes" onclick="goTo('notes',this)"><span class="nav-icon">ğŸ“‚</span> Notes</div>
    <div class="nav-link" data-page="ai" onclick="goTo('ai',this)"><span class="nav-icon">ğŸ¤–</span> AI Assistant</div>
    <div class="nav-link" data-page="profile" onclick="goTo('profile',this)"><span class="nav-icon">ğŸ‘¤</span> Profile</div>

    <div class="sidebar-user" id="sidebar-user">
      <div class="sidebar-user-name" id="sb-name">â€”</div>
      <div class="sidebar-user-email" id="sb-email">â€”</div>
    </div>
  </nav>

  <!-- Main -->
  <main class="main">

    <!-- â”€â”€â”€ DASHBOARD â”€â”€â”€ -->
    <div class="page active" id="page-dashboard">
      <div class="ph">
        <div class="ph-title" id="dash-greeting">Good morning ğŸ‘‹</div>
        <div class="ph-sub">Here's your academic overview</div>
      </div>

      <div class="g4 mb24" id="stat-grid">
        <div class="stat-card s-accent"><div class="stat-num" id="st-total" style="color:var(--accent)">0</div><div class="stat-lbl">Total Tasks</div></div>
        <div class="stat-card s-teal"><div class="stat-num" id="st-done" style="color:var(--teal)">0</div><div class="stat-lbl">Completed</div></div>
        <div class="stat-card s-coral"><div class="stat-num" id="st-pending" style="color:var(--coral)">0</div><div class="stat-lbl">Pending</div></div>
        <div class="stat-card s-gold"><div class="stat-num" id="st-notes" style="color:var(--gold)">0</div><div class="stat-lbl">Notes Saved</div></div>
      </div>

      <div class="g2 mb24">
        <div class="card">
          <div class="card-title">ğŸ“Š Completion Progress</div>
          <div class="row" style="gap:24px">
            <div class="ring-wrap">
              <svg id="ring-svg" width="110" height="110" style="transform:rotate(-90deg)">
                <circle cx="55" cy="55" r="44" fill="none" stroke="var(--border2)" stroke-width="10"/>
                <circle id="ring-fill" cx="55" cy="55" r="44" fill="none" stroke="var(--accent)" stroke-width="10"
                  stroke-dasharray="276.46" stroke-dashoffset="276.46"
                  stroke-linecap="round" style="transition:stroke-dashoffset 1s cubic-bezier(.4,0,.2,1)"/>
              </svg>
              <div class="ring-label">
                <div class="ring-pct" id="ring-pct" style="color:var(--accent)">0%</div>
                <div class="ring-lbl">Done</div>
              </div>
            </div>
            <div style="flex:1">
              <div class="mb8">
                <div class="row text-sm" style="justify-content:space-between;margin-bottom:4px"><span>Completed</span><span id="pb-done" style="color:var(--teal)">0</span></div>
                <div class="progress-bar-wrap"><div class="progress-bar-fill" id="pb-done-bar" style="background:var(--teal);width:0%"></div></div>
              </div>
              <div>
                <div class="row text-sm" style="justify-content:space-between;margin-bottom:4px"><span>Pending</span><span id="pb-pend" style="color:var(--coral)">0</span></div>
                <div class="progress-bar-wrap"><div class="progress-bar-fill" id="pb-pend-bar" style="background:var(--coral);width:0%"></div></div>
              </div>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-title">ğŸ“… Tasks by Deadline Day</div>
          <div class="bar-chart" id="bar-chart">
            <!-- JS fills this -->
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-title">ğŸ”¥ Recent Tasks</div>
        <div id="recent-tasks"><div class="muted text-sm">No tasks yet â€” add some in the Tasks tab!</div></div>
      </div>
    </div>

    <!-- â”€â”€â”€ TASKS â”€â”€â”€ -->
    <div class="page" id="page-tasks">
      <div class="ph">
        <div class="ph-title">ğŸ“ Task Manager</div>
        <div class="ph-sub">Organize your assignments and deadlines</div>
      </div>

      <div class="card mb24">
        <div class="card-title" id="task-form-title">â• Add New Task</div>
        <div class="g2" style="gap:12px;margin-bottom:12px">
          <div><label class="form-label">Task Title</label><input id="t-title" class="input" placeholder="e.g. Write essay on Shakespeareâ€¦" /></div>
          <div><label class="form-label">Deadline</label><input id="t-deadline" class="input" type="date" /></div>
        </div>
        <div class="g2" style="gap:12px;margin-bottom:16px">
          <div><label class="form-label">Subject (optional)</label><input id="t-subject" class="input" placeholder="e.g. English Literature" /></div>
          <div><label class="form-label">Priority</label>
            <select id="t-priority" class="input">
              <option value="high">ğŸ”´ High</option>
              <option value="medium" selected>ğŸŸ¡ Medium</option>
              <option value="low">ğŸŸ¢ Low</option>
            </select>
          </div>
        </div>
        <div class="row">
          <button class="btn btn-primary" onclick="saveTask()"><span id="task-btn-txt">â• Add Task</span></button>
          <button class="btn btn-ghost" id="cancel-edit-btn" style="display:none" onclick="cancelEditTask()">Cancel</button>
        </div>
      </div>

      <div class="row mb16">
        <button class="btn btn-ghost btn-sm" id="f-all" onclick="setFilter('all',this)" style="border-color:var(--accent);color:var(--accent2)">All</button>
        <button class="btn btn-ghost btn-sm" id="f-pending" onclick="setFilter('pending',this)">Pending</button>
        <button class="btn btn-ghost btn-sm" id="f-done" onclick="setFilter('done',this)">Completed</button>
        <span class="muted text-xs" style="margin-left:auto" id="task-count">0 tasks</span>
      </div>

      <div id="task-list"><div class="center muted text-sm" style="padding:40px">No tasks here yet!</div></div>
    </div>

    <!-- â”€â”€â”€ TIMETABLE â”€â”€â”€ -->
    <div class="page" id="page-timetable">
      <div class="ph">
        <div class="ph-title">ğŸ“… Timetable Generator</div>
        <div class="ph-sub">Auto-create your perfect weekly study schedule</div>
      </div>

      <div class="card mb24">
        <div class="card-title">âš™ï¸ Setup Your Schedule</div>
        <div class="g2" style="gap:14px;margin-bottom:16px">
          <div>
            <label class="form-label">Add Subject</label>
            <div class="row">
              <input id="tt-subinput" class="input" placeholder="e.g. Mathematics" onkeydown="if(event.key==='Enter')addTTSubject()" />
              <button class="btn btn-primary" onclick="addTTSubject()">+</button>
            </div>
          </div>
          <div>
            <label class="form-label">Study Hours Per Day: <span id="hours-val">4</span></label>
            <input type="range" min="2" max="9" value="4" id="tt-hours"
              oninput="document.getElementById('hours-val').textContent=this.value"
              style="width:100%;accent-color:var(--accent);margin-top:14px;cursor:pointer" />
          </div>
        </div>
        <div id="tt-subjects-wrap" class="row" style="flex-wrap:wrap;gap:8px;min-height:28px;margin-bottom:16px"></div>
        <button class="btn btn-teal" onclick="generateTimetable()">ğŸ—“ï¸ Generate Timetable</button>
      </div>

      <div class="card" id="tt-result-card" style="display:none">
        <div class="card-title">ğŸ“‹ Your Weekly Schedule</div>
        <div class="tt-wrap"><div class="tt" id="tt-grid"></div></div>
      </div>
    </div>

    <!-- â”€â”€â”€ NOTES â”€â”€â”€ -->
    <div class="page" id="page-notes">
      <div class="ph">
        <div class="ph-title">ğŸ“‚ Notes & Files</div>
        <div class="ph-sub">Upload, manage, and download your study materials</div>
      </div>

      <div class="dropzone" id="dropzone" onclick="document.getElementById('file-input').click()"
        ondragover="event.preventDefault();this.classList.add('dragging')"
        ondragleave="this.classList.remove('dragging')"
        ondrop="handleDrop(event)">
        <div class="dz-icon">â˜ï¸</div>
        <div class="dz-text">Drop files here or click to upload</div>
        <div class="dz-hint">PDF, images, Word, text files accepted</div>
        <input type="file" id="file-input" multiple accept=".pdf,image/*,.doc,.docx,.txt" style="display:none" onchange="handleFiles(this.files)" />
      </div>

      <div id="notes-grid" class="notes-grid">
        <div class="center muted text-sm" style="padding:40px;grid-column:1/-1">No files uploaded yet</div>
      </div>
    </div>

    <!-- â”€â”€â”€ AI ASSISTANT â”€â”€â”€ -->
    <div class="page" id="page-ai">
      <div class="ph">
        <div class="ph-title">ğŸ¤– AI Study Assistant</div>
        <div class="ph-sub">Powered by Claude â€” your personal academic companion</div>
      </div>

      <div class="card">
        <div class="chat-area" id="chat-area">
          <div class="msg bot">
            <div class="msg-avatar">âœ¨</div>
            <div class="msg-bubble">Hi! I'm your AI study assistant ğŸ“ Ask me anything â€” study strategies, help with your tasks, subject questions, or just need some motivation!</div>
          </div>
        </div>
        <div class="row">
          <input id="chat-input" class="input" placeholder="Ask me anything academicâ€¦" style="flex:1" onkeydown="if(event.key==='Enter')sendChat()" />
          <button class="btn btn-primary" onclick="sendChat()">Send âœ¨</button>
        </div>
        <div class="quick-chips mt16">
          <div class="chip" onclick="setChip(this)">How to study effectively?</div>
          <div class="chip" onclick="setChip(this)">Help manage my deadlines</div>
          <div class="chip" onclick="setChip(this)">Give me motivation!</div>
          <div class="chip" onclick="setChip(this)">Best note-taking methods?</div>
        </div>
      </div>
    </div>

    <!-- â”€â”€â”€ PROFILE â”€â”€â”€ -->
<div class="card">
  <div class="card-title">ğŸ† Your Stats</div>
  <div class="flex-center mb16">
    <div class="ring-wrap">
      <svg width="100" height="100" style="transform: rotate(-90deg)">
        <!-- Background circle -->
        <circle cx="50" cy="50" r="44" fill="none" stroke="var(--border2)" stroke-width="10"/>
        <!-- Progress fill circle -->
        <circle id="profile-ring-fill" cx="50" cy="50" r="44" fill="none" stroke="var(--accent)" stroke-width="10"
          stroke-dasharray="276.46" stroke-dashoffset="276.46"
          stroke-linecap="round"
          style="transition: stroke-dashoffset 1s cubic-bezier(.4,0,.2,1)"/>
      </svg>
      <div class="ring-label">
        <div class="ring-pct" id="profile-ring-pct" style="color:var(--accent)">0%</div>
        <div class="ring-lbl">Completed</div>
      </div>
    </div>
  </div>

  <div class="g2">
    <div class="profile-stat">
      <div class="val" id="stat-total-tasks">0</div>
      <div class="lbl">Total Tasks</div>
    </div>
    <div class="profile-stat">
      <div class="val" id="stat-completed-tasks">0</div>
      <div class="lbl">Completed</div>
    </div>
    <div class="profile-stat">
      <div class="val" id="stat-pending-tasks">0</div>
      <div class="lbl">Pending</div>
    </div>
    <div class="profile-stat">
      <div class="val" id="stat-notes">0</div>
      <div class="lbl">Notes Saved</div>
    </div>
  </div>
</div>

  </main>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• JS â•â• -->
<script>
// â”€â”€â”€ STATE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let STATE = {
  user: null,
  tasks: [],
  notes: [],
  ttSubjects: [],
  taskFilter: 'all',
  editingTaskId: null,
  authMode: 'login',
  chatHistory: []
};
const SUB_COLORS = ['#7c6af7','#2dd4bf','#f87171','#fbbf24','#a78bfa','#34d399','#fb923c','#ec4899'];
const DAYS = ['Mon','Tue','Wed','Thu','Fri','Sat','Sun'];
const SLOTS = ['08:00','09:00','10:00','11:00','13:00','14:00','15:00','16:00','17:00','19:00'];

// â”€â”€â”€ PERSIST â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const save = (key, val) => { try { localStorage.setItem(key, JSON.stringify(val)); } catch(e){} };
const load = (key, def) => { try { const v = localStorage.getItem(key); return v ? JSON.parse(v) : def; } catch(e){ return def; } };

function init() {
  STATE.tasks = load('sm_tasks', []);
  STATE.notes = load('sm_notes', []);
  const session = load('sm_session', null);
  if (session) {
    STATE.user = session;
    showApp();
  }
  startCanvas();
}

// â”€â”€â”€ AUTH â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function toggleAuthMode() {
  STATE.authMode = STATE.authMode === 'login' ? 'register' : 'login';
  const isReg = STATE.authMode === 'register';
  document.getElementById('auth-title').textContent = isReg ? 'Create Account' : 'Welcome back';
  document.getElementById('auth-sub').textContent = isReg ? 'Join thousands of students' : 'Log in to continue your journey';
  document.getElementById('auth-name-group').style.display = isReg ? 'block' : 'none';
  document.getElementById('auth-btn-text').textContent = isReg ? 'âœ¨ Create Account' : 'ğŸš€ Sign In';
  document.getElementById('auth-switch-text').textContent = isReg ? 'Already have an account?' : "Don't have an account?";
  document.getElementById('auth-switch-link').textContent = isReg ? 'Sign in' : 'Sign up';
}

function authSubmit() {
  const email = document.getElementById('auth-email').value.trim();
  const pass = document.getElementById('auth-pass').value;
  const name = document.getElementById('auth-name').value.trim();
  if (!email || !pass) { toast('Fill all fields âš ï¸'); return; }
  const users = load('sm_users', []);
  if (STATE.authMode === 'register') {
    if (!name) { toast('Name required âš ï¸'); return; }
    if (users.find(u => u.email === email)) { toast('Email already exists âŒ'); return; }
    const u = { id: uid(), name, email, password: pass, joinedAt: new Date().toISOString() };
    users.push(u); save('sm_users', users);
    STATE.user = u; save('sm_session', u);
    toast('Account created! ğŸ‰'); showApp();
  } else {
    const u = users.find(u => u.email === email && u.password === pass);
    if (!u) { toast('Invalid credentials âŒ'); return; }
    STATE.user = u; save('sm_session', u);
    toast('Welcome back, ' + u.name.split(' ')[0] + '! ğŸ‘‹'); showApp();
  }
}

function logout() {
  STATE.user = null; localStorage.removeItem('sm_session');
  document.getElementById('main-app').style.display = 'none';
  document.getElementById('auth-screen').style.display = 'flex';
  toast('Logged out ğŸ‘‹');
}

// â”€â”€â”€ SHOW APP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showApp() {
  document.getElementById('auth-screen').style.display = 'none';
  document.getElementById('main-app').style.display = 'flex';
  const u = STATE.user;
  document.getElementById('sb-name').textContent = u.name;
  document.getElementById('sb-email').textContent = u.email;
  const h = new Date().getHours();
  document.getElementById('dash-greeting').textContent = (h<12?'Good morning':h<17?'Good afternoon':'Good evening') + ', ' + u.name.split(' ')[0] + ' ğŸ‘‹';
  updateDashboard(); renderTasks(); renderNotes(); updateProfile();
}

// â”€â”€â”€ NAVIGATION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function goTo(page, el) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
  document.getElementById('page-' + page).classList.add('active');
  el.classList.add('active');
  if (page === 'dashboard') updateDashboard();
  if (page === 'profile') updateProfile();
  closeSidebar();
}

function toggleSidebar() { document.getElementById('sidebar').classList.toggle('open'); }
function closeSidebar() { document.getElementById('sidebar').classList.remove('open'); }

// â”€â”€â”€ TASKS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const PRIO_C = { high:'#f87171', medium:'#fbbf24', low:'#2dd4bf' };

function saveTask() {
  const title = document.getElementById('t-title').value.trim();
  const deadline = document.getElementById('t-deadline').value;
  const subject = document.getElementById('t-subject').value.trim();
  const priority = document.getElementById('t-priority').value;
  if (!title) { toast('Task title required âš ï¸'); return; }
  if (STATE.editingTaskId) {
    STATE.tasks = STATE.tasks.map(t => t.id === STATE.editingTaskId ? {...t, title, deadline, subject, priority} : t);
    toast('Task updated âœï¸'); cancelEditTask();
  } else {
    STATE.tasks.push({ id: uid(), title, deadline, subject, priority, done: false, createdAt: new Date().toISOString() });
    toast('Task added âœ…');
  }
  save('sm_tasks', STATE.tasks);
  clearTaskForm(); renderTasks(); updateDashboard();
}

function clearTaskForm() {
  ['t-title','t-deadline','t-subject'].forEach(id => document.getElementById(id).value = '');
  document.getElementById('t-priority').value = 'medium';
}

function editTask(id) {
  const t = STATE.tasks.find(t => t.id === id); if (!t) return;
  STATE.editingTaskId = id;
  document.getElementById('t-title').value = t.title;
  document.getElementById('t-deadline').value = t.deadline || '';
  document.getElementById('t-subject').value = t.subject || '';
  document.getElementById('t-priority').value = t.priority || 'medium';
  document.getElementById('task-form-title').textContent = 'âœï¸ Edit Task';
  document.getElementById('task-btn-txt').textContent = 'ğŸ’¾ Save Changes';
  document.getElementById('cancel-edit-btn').style.display = 'inline-flex';
  document.querySelector('#page-tasks').scrollTop = 0;
}

function cancelEditTask() {
  STATE.editingTaskId = null;
  clearTaskForm();
  document.getElementById('task-form-title').textContent = 'â• Add New Task';
  document.getElementById('task-btn-txt').textContent = 'â• Add Task';
  document.getElementById('cancel-edit-btn').style.display = 'none';
}

function toggleTask(id) {
  STATE.tasks = STATE.tasks.map(t => t.id === id ? {...t, done: !t.done} : t);
  save('sm_tasks', STATE.tasks); renderTasks(); updateDashboard();
}

function deleteTask(id) {
  STATE.tasks = STATE.tasks.filter(t => t.id !== id);
  save('sm_tasks', STATE.tasks); renderTasks(); updateDashboard();
  toast('Task deleted ğŸ—‘ï¸');
}

function setFilter(f, btn) {
  STATE.taskFilter = f;
  document.querySelectorAll('#page-tasks .btn-ghost.btn-sm').forEach(b => {
    b.style.borderColor = ''; b.style.color = '';
  });
  btn.style.borderColor = 'var(--accent)'; btn.style.color = 'var(--accent2)';
  renderTasks();
}

function renderTasks() {
  const list = document.getElementById('task-list');
  let filtered = STATE.tasks;
  if (STATE.taskFilter === 'done') filtered = filtered.filter(t => t.done);
  if (STATE.taskFilter === 'pending') filtered = filtered.filter(t => !t.done);
  document.getElementById('task-count').textContent = filtered.length + ' task' + (filtered.length !== 1 ? 's' : '');

  // Badge
  const pend = STATE.tasks.filter(t => !t.done).length;
  const badge = document.getElementById('pending-badge');
  badge.style.display = pend > 0 ? 'inline-block' : 'none';
  badge.textContent = pend;

  if (!filtered.length) { list.innerHTML = '<div class="center muted text-sm" style="padding:40px">No tasks here!</div>'; return; }
  list.innerHTML = filtered.map(t => {
    const late = t.deadline && !t.done && new Date(t.deadline) < new Date();
    const dateStr = t.deadline ? new Date(t.deadline).toLocaleDateString('en-US',{month:'short',day:'numeric'}) : '';
    return `<div class="task-item ${t.done?'done':''}" id="ti-${t.id}">
      <div class="task-prio" style="background:${PRIO_C[t.priority||'medium']}"></div>
      <div class="task-check ${t.done?'on':''}" onclick="toggleTask('${t.id}')">${t.done?'âœ“':''}</div>
      <div style="flex:1">
        <div class="task-name">${esc(t.title)}</div>
        ${t.subject?`<div class="text-xs muted" style="margin-top:2px">${esc(t.subject)}</div>`:''}
      </div>
      ${dateStr?`<div class="task-meta ${late?'late':''}">ğŸ“… ${dateStr}</div>`:''}
      <button class="btn btn-ghost btn-icon" onclick="editTask('${t.id}')" title="Edit">âœï¸</button>
      <button class="btn btn-ghost btn-icon" onclick="deleteTask('${t.id}')" title="Delete">ğŸ—‘ï¸</button>
    </div>`;
  }).join('');
}

// â”€â”€â”€ DASHBOARD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function updateDashboard() {
  const total = STATE.tasks.length;
  const done = STATE.tasks.filter(t => t.done).length;
  const pend = total - done;
  const pct = total ? Math.round((done/total)*100) : 0;
  document.getElementById('st-total').textContent = total;
  document.getElementById('st-done').textContent = done;
  document.getElementById('st-pending').textContent = pend;
  document.getElementById('st-notes').textContent = STATE.notes.length;
  document.getElementById('ring-pct').textContent = pct + '%';
  const circ = 276.46;
  document.getElementById('ring-fill').setAttribute('stroke-dashoffset', circ - (pct/100)*circ);
  document.getElementById('pb-done').textContent = done;
  document.getElementById('pb-pend').textContent = pend;
  document.getElementById('pb-done-bar').style.width = (total ? (done/total)*100 : 0) + '%';
  document.getElementById('pb-pend-bar').style.width = (total ? (pend/total)*100 : 0) + '%';
  // Bar chart
  const byDay = DAYS.map((d,i)=>({ d, n: STATE.tasks.filter(t=>{ const dd=t.deadline?new Date(t.deadline).getDay():null; return dd===(i+1)%7+(i===6?0:0); }).length }));
  // Fix: map Mon=1..Sun=0
  const dayNums = [1,2,3,4,5,6,0];
  const byDay2 = DAYS.map((d,i)=>({ d, n: STATE.tasks.filter(t=>t.deadline && new Date(t.deadline).getDay()===dayNums[i]).length }));
  const mx = Math.max(...byDay2.map(b=>b.n), 1);
  document.getElementById('bar-chart').innerHTML = byDay2.map(b=>`
    <div class="bar-col">
      <div class="bar-count">${b.n}</div>
      <div class="bar-fill" style="height:${(b.n/mx)*100}%;background:linear-gradient(to top,var(--accent),var(--teal))"></div>
      <div class="bar-day">${b.d}</div>
    </div>`).join('');
  // Recent tasks
  const recent = [...STATE.tasks].slice(-5).reverse();
  document.getElementById('recent-tasks').innerHTML = recent.length ? recent.map(t=>`
    <div style="display:flex;align-items:center;gap:10px;padding:10px 0;border-bottom:1px solid var(--border)">
      <span>${t.done?'âœ…':'â³'}</span>
      <span style="flex:1;font-size:14px;${t.done?'text-decoration:line-through;opacity:.5':''}">${esc(t.title)}</span>
      ${t.deadline?`<span class="text-xs muted">${new Date(t.deadline).toLocaleDateString('en-US',{month:'short',day:'numeric'})}</span>`:''}
    </div>`).join('') : '<div class="muted text-sm">No tasks yet!</div>';
}

// â”€â”€â”€ TIMETABLE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function addTTSubject() {
  const inp = document.getElementById('tt-subinput');
  const val = inp.value.trim(); if (!val) return;
  if (STATE.ttSubjects.length >= 8) { toast('Max 8 subjects âš ï¸'); return; }
  STATE.ttSubjects.push({ name: val, color: SUB_COLORS[STATE.ttSubjects.length % 8] });
  inp.value = ''; renderTTSubjects();
}

function removeTTSubject(i) {
  STATE.ttSubjects.splice(i, 1); renderTTSubjects();
}

function renderTTSubjects() {
  document.getElementById('tt-subjects-wrap').innerHTML = STATE.ttSubjects.map((s,i)=>`
    <span class="sub-tag" style="background:${s.color}22;color:${s.color}">
      ${esc(s.name)} <span class="rem" onclick="removeTTSubject(${i})">Ã—</span>
    </span>`).join('');
}

function generateTimetable() {
  if (!STATE.ttSubjects.length) { toast('Add at least one subject âš ï¸'); return; }
  const hours = parseInt(document.getElementById('tt-hours').value);
  const slots = SLOTS.slice(0, hours);
  const sched = {};
  DAYS.forEach(d => {
    sched[d] = {};
    const shuffled = [...STATE.ttSubjects].sort(()=>Math.random()-.5);
    slots.forEach((sl,i) => { sched[d][sl] = shuffled[i % shuffled.length]; });
  });
  // Build grid
  const card = document.getElementById('tt-result-card');
  card.style.display = 'block';
  const grid = document.getElementById('tt-grid');
  grid.style.gridTemplateColumns = `72px repeat(7,1fr)`;
  let html = `<div class="tt-h">Time</div>` + DAYS.map(d=>`<div class="tt-h">${d}</div>`).join('');
  slots.forEach(sl => {
    html += `<div class="tt-t">${sl}</div>`;
    DAYS.forEach(d => {
      const s = sched[d][sl];
      html += s ? `<div class="tt-c" style="background:${s.color}18;color:${s.color}">${esc(s.name)}</div>`
                : `<div class="tt-c">â€”</div>`;
    });
  });
  grid.innerHTML = html;
  toast('Timetable generated! ğŸ“…');
}

// â”€â”€â”€ NOTES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function handleDrop(e) {
  e.preventDefault();
  document.getElementById('dropzone').classList.remove('dragging');
  handleFiles(e.dataTransfer.files);
}

function handleFiles(files) {
  Array.from(files).forEach(file => {
    const reader = new FileReader();
    reader.onload = ev => {
      STATE.notes.push({ id: uid(), name: file.name, size: file.size, type: file.type, data: ev.target.result, uploadedAt: new Date().toISOString() });
      save('sm_notes', STATE.notes);
      renderNotes(); updateDashboard();
      toast(file.name + ' uploaded! ğŸ“„');
    };
    reader.readAsDataURL(file);
  });
}

function downloadNote(id) {
  const n = STATE.notes.find(n => n.id === id); if (!n) return;
  const a = document.createElement('a');
  a.href = n.data; a.download = n.name; a.click();
  toast('Download started â¬‡ï¸');
}

function deleteNote(id) {
  STATE.notes = STATE.notes.filter(n => n.id !== id);
  save('sm_notes', STATE.notes); renderNotes(); updateDashboard();
  toast('File deleted ğŸ—‘ï¸');
}

function renderNotes() {
  const grid = document.getElementById('notes-grid');
  document.getElementById('st-notes').textContent = STATE.notes.length;
  if (!STATE.notes.length) { grid.innerHTML = '<div class="center muted text-sm" style="padding:40px;grid-column:1/-1">No files uploaded yet</div>'; return; }
  const getIcon = t => t?.includes('pdf')? 'ğŸ“•' : t?.includes('image')? 'ğŸ–¼ï¸' : t?.includes('word')||t?.includes('document')? 'ğŸ“' : 'ğŸ“„';
  grid.innerHTML = STATE.notes.map(n=>`
    <div class="note-card">
      <div class="note-icon-big">${getIcon(n.type)}</div>
      <div class="note-fname">${esc(n.name)}</div>
      <div class="note-fsize">${(n.size/1024).toFixed(1)} KB</div>
      <div class="note-fsize" style="margin-bottom:12px">${new Date(n.uploadedAt).toLocaleDateString()}</div>
      <div class="row" style="justify-content:center;gap:8px">
        <button class="btn btn-teal btn-sm" onclick="downloadNote('${n.id}')">â¬‡ï¸ Download</button>
        <button class="btn btn-ghost btn-sm" onclick="deleteNote('${n.id}')">ğŸ—‘ï¸</button>
      </div>
    </div>`).join('');
}

// â”€â”€â”€ AI CHAT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function setChip(el) { document.getElementById('chat-input').value = el.textContent; document.getElementById('chat-input').focus(); }

async function sendChat() {
  const inp = document.getElementById('chat-input');
  const text = inp.value.trim(); if (!text) return;
  inp.value = '';
  appendMsg('user', text);
  STATE.chatHistory.push({ role: 'user', content: text });

  // Typing indicator
  const typingId = 'typing-' + uid();
  appendMsg('bot', '<div class="dots"><span></span><span></span><span></span></div>', typingId);

  const taskCtx = STATE.tasks.length
    ? `User has ${STATE.tasks.length} tasks: ${STATE.tasks.slice(0,5).map(t=>`"${t.title}" (${t.done?'done':'pending'}${t.deadline?', due '+t.deadline:''})`).join(', ')}.`
    : 'User has no tasks yet.';

  try {
    const res = await fetch('https://api.anthropic.com/v1/messages', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        model: 'claude-sonnet-4-20250514',
        max_tokens: 500,
        system: `You are StudyMate's helpful AI assistant for ${STATE.user?.name || 'a student'}. Be concise (2-3 short paragraphs max), warm, practical. ${taskCtx}`,
        messages: STATE.chatHistory
      })
    });
    const data = await res.json();
    const reply = data.content?.[0]?.text || 'Sorry, I could not respond right now.';
    document.getElementById(typingId)?.remove();
    appendMsg('bot', reply);
    STATE.chatHistory.push({ role: 'assistant', content: reply });
    if (STATE.chatHistory.length > 20) STATE.chatHistory = STATE.chatHistory.slice(-20);
  } catch(e) {
    document.getElementById(typingId)?.remove();
    appendMsg('bot', 'Connection error. Please check your network and try again.');
  }
}

function appendMsg(role, html, id='') {
  const area = document.getElementById('chat-area');
  const el = document.createElement('div');
  el.className = 'msg ' + role;
  if (id) el.id = id;
  el.innerHTML = `
    <div class="msg-avatar">${role==='bot'?'âœ¨':(STATE.user?.name[0]||'U')}</div>
    <div class="msg-bubble">${html}</div>`;
  area.appendChild(el);
  area.scrollTop = area.scrollHeight;
}

// â”€â”€â”€ PROFILE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function updateProfile() {
  const u = STATE.user; if (!u) return;
  document.getElementById('profile-avatar').textContent = u.name[0].toUpperCase();
  document.getElementById('profile-name').textContent = u.name;
  document.getElementById('profile-email').textContent = u.email;
  document.getElementById('profile-joined').textContent = 'Joined ' + new Date(u.joinedAt).toLocaleDateString('en-US',{month:'long',year:'numeric'});
  const total = STATE.tasks.length, done = STATE.tasks.filter(t=>t.done).length;
  const pct = total ? Math.round((done/total)*100) : 0;
  document.getElementById('profile-pct').textContent = pct + '%';
  document.getElementById('profile-ring').setAttribute('stroke-dashoffset', 251.33 - (pct/100)*251.33);
  document.getElementById('ps-total').textContent = total;
  document.getElementById('ps-done').textContent = done;
  document.getElementById('ps-pend').textContent = total - done;
  document.getElementById('ps-notes').textContent = STATE.notes.length;
}

function showEditProfile() {
  document.getElementById('profile-name-input').value = STATE.user.name;
  document.getElementById('profile-view-btns').style.display = 'none';
  document.getElementById('profile-edit-form').style.display = 'block';
}

function cancelEditProfile() {
  document.getElementById('profile-view-btns').style.display = 'flex';
  document.getElementById('profile-edit-form').style.display = 'none';
}

function saveProfile() {
  const name = document.getElementById('profile-name-input').value.trim();
  if (!name) return;
  const users = load('sm_users', []);
  const updated = users.map(u => u.id === STATE.user.id ? {...u, name} : u);
  save('sm_users', updated);
  STATE.user = {...STATE.user, name};
  save('sm_session', STATE.user);
  document.getElementById('sb-name').textContent = name;
  updateProfile(); cancelEditProfile();
  toast('Profile updated âœ…');
}

// â”€â”€â”€ TOAST â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function toast(msg) {
  const el = document.createElement('div');
  el.className = 'toast';
  el.innerHTML = `<span>${msg}</span>`;
  document.getElementById('toast-container').appendChild(el);
  setTimeout(() => el.remove(), 3200);
}

// â”€â”€â”€ UTILS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function uid() { return Math.random().toString(36).slice(2, 9); }
function esc(s) { return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;'); }

// â”€â”€â”€ CANVAS BG â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function startCanvas() {
  const canvas = document.getElementById('bg-canvas');
  const ctx = canvas.getContext('2d');
  let W, H, raf;
  const particles = [];
  const lines = [];

  function resize() {
    W = canvas.width = window.innerWidth;
    H = canvas.height = window.innerHeight;
  }

  function setup() {
    particles.length = 0; lines.length = 0;
    for (let i = 0; i < 70; i++) particles.push({
      x: Math.random()*W, y: Math.random()*H,
      vx: (Math.random()-.5)*.35, vy: (Math.random()-.5)*.35,
      r: Math.random()*2.5+1,
      col: SUB_COLORS[Math.floor(Math.random()*SUB_COLORS.length)]
    });
    for (let i = 0; i < 25; i++) lines.push({
      x1:Math.random()*W, y1:Math.random()*H,
      x2:Math.random()*W, y2:Math.random()*H,
      vx1:(Math.random()-.5)*.18, vy1:(Math.random()-.5)*.18,
      vx2:(Math.random()-.5)*.18, vy2:(Math.random()-.5)*.18,
      col: SUB_COLORS[Math.floor(Math.random()*SUB_COLORS.length)]
    });
  }

  function draw() {
    ctx.clearRect(0, 0, W, H);
    lines.forEach(l => {
      l.x1+=l.vx1; l.y1+=l.vy1; l.x2+=l.vx2; l.y2+=l.vy2;
      if(l.x1<0||l.x1>W) l.vx1*=-1; if(l.y1<0||l.y1>H) l.vy1*=-1;
      if(l.x2<0||l.x2>W) l.vx2*=-1; if(l.y2<0||l.y2>H) l.vy2*=-1;
      ctx.beginPath(); ctx.moveTo(l.x1,l.y1); ctx.lineTo(l.x2,l.y2);
      ctx.strokeStyle = l.col+'14'; ctx.lineWidth=1; ctx.stroke();
    });
    particles.forEach(p => {
      p.x+=p.vx; p.y+=p.vy;
      if(p.x<0||p.x>W) p.vx*=-1; if(p.y<0||p.y>H) p.vy*=-1;
      ctx.beginPath(); ctx.arc(p.x,p.y,p.r,0,Math.PI*2);
      ctx.fillStyle = p.col+'55'; ctx.fill();
    });
    raf = requestAnimationFrame(draw);
  }

  window.addEventListener('resize', () => { resize(); setup(); });
  resize(); setup(); draw();
}

// â”€â”€â”€ BOOT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window.addEventListener('DOMContentLoaded', init);
</script>
</body>
</html>
